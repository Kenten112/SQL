--1 clientes que no son de USA
select CustomerId, FirstName, LastName, country
from customers
where not country = 'USA'
order by country asc;

--2 Clientes de Brazil
select CustomerId, FirstName, LastName, country
from customers
where country = 'Brazil'
order by country asc;

--3 Clientes de Brazil, con su facturación
select firstname, lastname, invoiceid, invoicedate, billingcountry
from customers inner join invoices on customers.customerid = invoices.customerid
where country = 'Brazil'
order by firstname asc;

--4 empleados que son agentes de ventas
select lastname, title
from employees
where title = 'Sales Support Agent'
order by lastname asc;

--5 lista de cobros por países
select distinct billingcountry
from invoices
order by billingcountry asc;

--6 cobros correspondientes a cada agente
SELECT 
    employees.FirstName AS EmployeeFirstName, 
    employees.LastName AS EmployeeLastName, 
    invoices.InvoiceId
FROM 
    employees 
INNER JOIN 
    customers ON employees.employeeid = customers.supportrepid
INNER JOIN 
    invoices ON customers.CustomerId = invoices.CustomerId
ORDER BY 
    employees.LastName ASC;
    
--7 total de facturas de los clientes, información personal, las facturas, los agentes que los contactaron
select total, customers.customerid, invoiceid, firstname, lastname, country, supportrepid
from customers full outer join invoices on customers.customerid = invoices.CustomerId
order by customers.customerid asc;

--8 cuantas facturas en el 2009
with invoice_2009 as (select invoicedate, invoiceid
from invoices
where invoicedate like '2009%'
) 
select count(invoiceid) as total_invoices
from invoice_2009;

--9 el total de ventas en el 2009
with invoice_2009 as (select*
from invoices
where invoicedate like '2009%'
)
select round (sum(total),1) as total_invoice_amount
from invoice_2009;

--10 nombre de canciones con sus invoice line id
select name, invoicelineid
from tracks inner join invoice_items on tracks.TrackId = invoice_items.TrackId
order by name asc;

--11 nombre del artista, invoice line ID y nombre del Track
select tracks.Name, artists.Name as artist_name, invoicelineid
from invoice_items left join tracks on tracks.TrackId = invoice_items.TrackId
inner join albums on tracks.AlbumId = albums.AlbumId
inner join artists on albums.ArtistId = artists.ArtistId
order by invoicelineid asc;

--12 todas las cnaciones, sus generos, media y nombre del album
select tracks.Name as track, title, media_types.name as media, genres.Name as genre
from tracks left join albums on tracks.AlbumId = albums.AlbumId
inner join genres on tracks.GenreId = genres.GenreId
inner join media_types on tracks.MediaTypeId = media_types.MediaTypeId
order by track asc;

--13 Total de ventas por cada agente
select employeeid, employees.FirstName, employees.LastName, round (sum(total),1) as total_sells
from employees inner join customers on employees.EmployeeId = customers.SupportRepId
inner join invoices on customers.CustomerId = invoices.CustomerId
group by employeeid
order by employees.LastName asc;

--14 Agente que vendio más en el 2009
with invoice_2009 as (select*
from invoices
where invoicedate like '2009%'
)
select employeeid, employees.FirstName, employees.LastName, round(sum(total),1) as total_sells
from employees inner join customers on employees.EmployeeId = customers.SupportRepId
inner join invoice_2009 on customers.CustomerId = invoice_2009.CustomerId
group by employeeid
order by total_sells desc
limit 1;
